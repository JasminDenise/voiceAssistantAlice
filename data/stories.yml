version: "3.1"

# ML policies: training data to teach assistant what to do next
# conversation training data /potential conversation flow
# actual user conversations, small stories, not full conversations
# memorization policy

stories:
  - story: restaurant booking process with turn tracking
    steps:
      - intent: greet
      - action: utter_greet
      - action: action_track_turns  # Track first turn
      - action: action_listen
      - intent: restaurant_request
      - action: restaurant_form  # Starts the restaurant booking form
      - active_loop: restaurant_form  # Form is active, it will ask for each slot
      - slot_was_set:
          - past_bookings: "yes I booked before at the restaurant 'La Bella Italia'"
      - action: action_track_turns  # Track turn after past_bookings
      - slot_was_set:
          - dietary_preferences: "vegetarian"
      - action: action_track_turns  # Track turn after dietary_preferences
      - slot_was_set:
          - cuisine_preferences: "italian"
      - action: action_track_turns  # Track turn after cuisine_preferences
      - slot_was_set:
          - time_of_booking: "7:00 PM"
      - action: action_track_turns  # Track turn after time_of_booking
      - slot_was_set:
          - day_of_booking: "Friday"
      - action: action_track_turns  # Track turn after day_of_booking
      - slot_was_set:
          - num_of_guests: 4
      - action: action_track_turns  # Track turn after num_of_guests
      - action: utter_booking_slots  # After all slots are filled, confirm the details
      - action: action_track_turns  # Track turn after utter_booking_slots
      - action: utter_confirm_booking  # Confirm the booking
      - intent: affirm
      - action: utter_submit
      - action: action_track_turns  # Track turn after confirmation

  - story: restaurant booking process with misunderstanding handling
    steps:
      - intent: greet
      - action: utter_greet
      - action: action_track_turns  # Track first turn
      - action: action_listen
      - intent: restaurant_request
      - action: restaurant_form  # Start the restaurant form
      - active_loop: restaurant_form  # Form will be active, and ask for missing slots
      - action: action_track_turns  # Track after starting the form
      - action: action_listen
      - intent: inform
      - action: action_default_fallback  # Bot doesn't understand user input
      - action: utter_default  # Bot asks user to rephrase
      - action: action_track_turns  # Track turn after fallback
      - action: utter_ask_past_bookings  # If the previous response was unclear, ask again
      - intent: past_bookings
      - slot_was_set:
          - past_bookings: "yes"
      - action: action_track_turns  # Track turn after asking about past bookings
      - action: action_listen